<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<configuration xmlns="urn:activemq" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="urn:activemq /schema/artemis-server.xsd">
   <core xmlns="urn:activemq:core">

        <!--

        broker.xml configuration docs
            https://activemq.apache.org/artemis/docs/latest/configuration-index.html

        HA cluster example
            https://github.com/apache/activemq-artemis/blob/master/examples/features/ha/colocated-failover-scale-down/src/main/resources/activemq/server0/broker.xml

        -->

        <!-- Enable database store (will disable paging) -->

        <!-- <store>
            <database-store>
                <jdbc-connection-url>jdbc:mariadb://mariadb:3306/artemis_store?createDatabaseIfNotExist=true</jdbc-connection-url>
                <bindings-table-name>bindings</bindings-table-name>
                <message-table-name>messages</message-table-name>
                <page-store-table-name>pages</page-store-table-name>
                <large-message-table-name>largemessages</large-message-table-name>
                <jdbc-driver-class-name>org.mariadb.jdbc.Driver</jdbc-driver-class-name>
            </database-store>
        </store> -->

        <!--
        <remoting-incoming-interceptors>
            <class-name>org.createnet.raptor.broker.interceptors.StompInterceptor</class-name>
            <class-name>org.createnet.raptor.broker.interceptors.IncomingInterceptor</class-name>
        </remoting-incoming-interceptors>
        -->
        <!--
        <remoting-outgoing-interceptors>
           <class-name>org.createnet.raptor.broker.interceptors.OutgoingInterceptor</class-name>
        </remoting-outgoing-interceptors>
        -->

        <!-- Enable message counter -->
        <message-counter-enabled>false</message-counter-enabled>

        <paging-directory>./data/paging</paging-directory>
        <bindings-directory>./data/bindings</bindings-directory>
        <journal-directory>./data/journal</journal-directory>
        <large-messages-directory>./data/large-messages</large-messages-directory>

        <persistence-enabled>true</persistence-enabled>

        <!-- this could be NIO, ASYNCIO or MAPPED -->
        <journal-type>MAPPED</journal-type>
        <journal-min-files>2</journal-min-files>
        <journal-pool-files>-1</journal-pool-files>

        <wild-card-routing-enabled>true</wild-card-routing-enabled>

        <connectors>
            <connector name="in-vm">vm://0</connector>
        </connectors>

        <acceptors>
            <!-- Default ActiveMQ Artemis Acceptor.  Multi-protocol adapter.  Currently supports ActiveMQ Artemis Core, OpenWire, STOMP, AMQP, MQTT, and HornetQ Core. -->
            <!-- performance tests have shown that openWire performs best with these buffer sizes -->
            <acceptor name="artemis">tcp://127.0.0.1:61616?tcpSendBufferSize=1048576;tcpReceiveBufferSize=1048576</acceptor>

            <!-- AMQP Acceptor.  Listens on default AMQP port for AMQP traffic.-->
            <acceptor name="amqp">tcp://127.0.0.1:5672?protocols=AMQP</acceptor>

            <!--
            MQTT Acceptor
             - check client failure if not communication happens in 10sec
            -->
            <acceptor name="mqtt">tcp://0.0.0.0:1883?protocols=MQTT&amp;clientFailureCheckPeriod=10000</acceptor>
        </acceptors>

        <address-settings>
            <!--default for catch all-->
            <address-setting match="#">

                <auto-create-jms-queues>true</auto-create-jms-queues>
                <auto-delete-jms-queues>true</auto-delete-jms-queues>

                <!--
                Delay redelivery of messages for 1.5s
                https://activemq.apache.org/artemis/docs/latest/undelivered-messages.html
                -->
                <!-- default is 1.0 -->
                <redelivery-delay-multiplier>1</redelivery-delay-multiplier>
                <!-- default is 0 (no delay) -->
                <redelivery-delay>500</redelivery-delay>
                <!-- default is redelivery-delay * 10 -->
                <max-redelivery-delay>1500</max-redelivery-delay>

                <!--
                Message expiry, remove to disable queue
                See https://activemq.apache.org/artemis/docs/latest/message-expiry.html
                -->
                <!--
                <expiry-address>jms.queue.ExpiryQueue</expiry-address>
                <expiry-delay>100</expiry-delay>
                -->

                <!-- Day to keep in history -->
                <message-counter-history-day-limit>10</message-counter-history-day-limit>

                <!--
                Paging config
                https://activemq.apache.org/artemis/docs/latest/paging.html
                -->
                <!-- 100MB = 100 * (1024 * 1024) -->
                <max-size-bytes>10010241024</max-size-bytes>
                <!-- 10MB = 10 * (1024 * 1024) -->
                <page-size-bytes>1010241024</page-size-bytes>
                <address-full-policy>PAGE</address-full-policy>

                <!-- Drop messages when queue is full -->
                <!-- <address-full-policy>DROP</address-full-policy> -->

            </address-setting>
        </address-settings>

        <security-settings>
            <security-setting match="#">
                <permission type="createNonDurableQueue" roles="user"/>
                <permission type="deleteNonDurableQueue" roles="user"/>
                <permission type="createDurableQueue" roles="user"/>
                <permission type="deleteDurableQueue" roles="user"/>
                <permission type="consume" roles="user"/>
                <permission type="send" roles="user"/>
                <!-- we need this otherwise ./artemis data imp wouldn't work -->
                <permission type="manage" roles="admin"/>
            </security-setting>
        </security-settings>

    </core>
</configuration>
